<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Coordonn√©es GPS entre deux villes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <button onclick="window.location.href='index.html'">Retour √† la page d'accueil</button>
  <h1>Coordonn√©es GPS</h1>

  <label for="fromCity">Ville de d√©part (laisser vide pour utiliser la position actuelle) :</label>
  <input type="text" id="fromCity" placeholder="Ex: Paris">

  <label for="toCity">Ville d'arriv√©e :</label>
  <input type="text" id="toCity" placeholder="Ex: Lyon">

  <button onclick="obtenirCoordonnees()">Obtenir les coordonn√©es</button>

  <div id="result" class="result"></div>

  <script>
    async function getCoordinates(city) {
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}`;
      const response = await fetch(url);
      const data = await response.json();
      if (data.length === 0) throw new Error("Ville non trouv√©e : " + city);
      return {
        lat: data[0].lat,
        lon: data[0].lon
      };
    }

    async function obtenirCoordonnees() {
      const fromCity = document.getElementById("fromCity").value.trim();
      const toCity = document.getElementById("toCity").value.trim();
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "Chargement...";

      if (!toCity) {
        resultDiv.innerHTML = "<span style='color:red'>Veuillez saisir une ville d'arriv√©e.</span>";
        return;
      }

      try {
        const toCoords = await getCoordinates(toCity);
        let fromCoords = null;

        if (fromCity) {
          fromCoords = await getCoordinates(fromCity);
        } else {
          fromCoords = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(
              pos => resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude }),
              err => reject("Impossible de r√©cup√©rer la position actuelle. V√©rifiez vos autorisations.")
            );
          });
        }

        const geoVeloURL = `https://geovelo.app/fr/route/?from=${fromCoords.lat},${fromCoords.lon}&to=${toCoords.lat},${toCoords.lon}`;
        const appleMapsURL = `http://maps.apple.com/?saddr=${fromCoords.lat},${fromCoords.lon}&daddr=${toCoords.lat},${toCoords.lon}`;
        const googleMapsURL = `https://www.google.com/maps/dir/${fromCoords.lat},${fromCoords.lon}/${toCoords.lat},${toCoords.lon}`;
        const wazeURL = `https://www.waze.com/fr/live-map/directions?navigate=yes&to=ll.${toCoords.lat}%2C${toCoords.lon}${fromCity ? `&from=${encodeURIComponent(fromCity)}` : ""}`;

        let html = `
          <p><strong>Coordonn√©es de d√©part :</strong> ${fromCoords.lat}, ${fromCoords.lon}</p>
          <p><strong>Coordonn√©es d'arriv√©e :</strong> ${toCoords.lat}, ${toCoords.lon}</p>
          <a class="button" href="${geoVeloURL}" target="_blank">üß± Ouvrir dans Geovelo</a>
          <a class="button" href="${googleMapsURL}" target="_blank">üìç Google Maps</a>
          <a class="button" href="${appleMapsURL}" target="_blank">üçé Apple Plans</a>
          <a class="button" href="${wazeURL}" target="_blank">üöó Waze</a>
        `;

        const viaMichelinObj = [];
        viaMichelinObj.push({
          label: fromCity || "Position actuelle",
          location: { lat: parseFloat(fromCoords.lat), lon: parseFloat(fromCoords.lon) },
          isDeparture: true,
          type: "city",
          inputType: "free",
          countryCode: "FRA"
        });
        viaMichelinObj.push({
          label: toCity,
          location: { lat: parseFloat(toCoords.lat), lon: parseFloat(toCoords.lon) },
          isArrival: true,
          type: "city",
          inputType: "free",
          countryCode: "FRA"
        });

        const viaMichelinURL = `https://www.viamichelin.fr/itineraires?itinerary=${encodeURIComponent(JSON.stringify(viaMichelinObj))}`;
        html += `<a class="button" href="${viaMichelinURL}" target="_blank">üö£Ô∏è ViaMichelin</a>`;

        resultDiv.innerHTML = html;

      } catch (err) {
        resultDiv.innerHTML = `<span style='color:red'>Erreur : ${err}</span>`;
      }
    }
  </script>
</body>
</html>
